@using WebApp.Models.Chat
@model WebApp.Models.PaginatedListDto<ChatFeedbackDto>

<div class="feedback-table-wrapper">
    <table class="feedback-table">
        <thead>
            <tr>
                <th class="col-stt">STT</th>
                <th class="col-question">Câu hỏi</th>
                <th class="col-response">Câu trả lời (Bot)</th>
                <th class="col-rating">Đánh giá</th>
                <th class="col-category">Phân loại</th>
                <th>Góp ý chi tiết</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Items == null || !Model.Items.Any())
            {
                <tr>
                    <td colspan="6" class="text-center" style="padding: 40px; color: #6c757d;">
                        <i class="ti ti-inbox" style="font-size: 2rem; display: block; margin-bottom: 10px;"></i>
                        Không có phản hồi nào
                    </td>
                </tr>
            }
            else
            {
                int stt = (Model.PageIndex - 1) * Model.PageSize + 1;
                foreach (var feedback in Model.Items)
                {
                    <tr>
                        <td>@stt</td>
                        <td class="bot-response">@feedback.Message</td>
                        <td class="bot-response">@feedback.Response</td>
                        <td>
                            @if (feedback.Ratings == 1)
                            {
                                <span class="badge badge-success">
                                    <i class="ti ti-thumb-up"></i> Thích
                                </span>
                            }
                            else if (feedback.Ratings == 2)
                            {
                                <span class="badge badge-danger">
                                    <i class="ti ti-thumb-down"></i> Không thích
                                </span>
                            }
                            else
                            {
                                <span class="badge badge-new">
                                    <i class="ti ti-minus"></i> Mặc định
                                </span>
                            }
                        </td>
                        <td>
                            <span class="badge badge-processing">
                                @{
                                    var categoryText = feedback.Category switch
                                    {
                                        ChatFeedbackCategory.WrongKnowledge => "Sai kiến thức pháp luật",
                                        ChatFeedbackCategory.OutdatedInfo => "Thông tin hết hiệu lực",
                                        ChatFeedbackCategory.ConflictingInfo => "Câu trả lời mâu thuẫn",
                                        ChatFeedbackCategory.Misunderstood => "Hiểu sai ý người dùng",
                                        ChatFeedbackCategory.WrongCitation => "Trích dẫn sai nguồn",
                                        ChatFeedbackCategory.MissingLegalBasis => "Thiếu căn cứ pháp lý",
                                        ChatFeedbackCategory.IrrelevantSource => "Nguồn không liên quan",
                                        ChatFeedbackCategory.TooVerbose => "Trả lời quá lan man",
                                        ChatFeedbackCategory.TooBrief => "Trả lời quá sơ sài",
                                        ChatFeedbackCategory.SlowResponse => "Phản hồi quá chậm",
                                        ChatFeedbackCategory.FormattingError => "Lỗi hiển thị/Định dạng",
                                        ChatFeedbackCategory.Other => "Khác",
                                        _ => feedback.Category.ToString()
                                    };
                                }
                                @categoryText
                            </span>
                        </td>
                        <td class="bot-response">
                            @if (!string.IsNullOrEmpty(feedback.Content))
                            {
                                @feedback.Content
                            }
                            else
                            {
                                <span style="color: #999;">-</span>
                            }
                        </td>
                    </tr>
                    stt++;
                }
            }
        </tbody>
    </table>
</div>

@if (Model.TotalPages > 1)
{
    <div class="pagination-container">
        <ul class="pagination">
            <li class="page-item @(Model.PageIndex == 1 ? "disabled" : "")">
                <a class="page-link" href="#" data-page="@(Model.PageIndex - 1)">
                    <i class="ti ti-chevron-left"></i> Trước
                </a>
            </li>

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                    <a class="page-link" href="#" data-page="@i">@i</a>
                </li>
            }

            <li class="page-item @(Model.PageIndex == Model.TotalPages ? "disabled" : "")">
                <a class="page-link" href="#" data-page="@(Model.PageIndex + 1)">
                    Sau <i class="ti ti-chevron-right"></i>
                </a>
            </li>
        </ul>
    </div>
}
