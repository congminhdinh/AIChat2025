@model int

<div class="edit-modal-container">
    <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-bold" id="changePasswordLabel">
            <i class="bi bi-shield-lock-fill text-warning me-2"></i>Thiết lập mật khẩu mới
        </h5>
        <button type="button" class="btn-close-modal" onclick="closeEditModal()">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    <div class="modal-body">
        <p class="text-muted small mb-4">
            Để đảm bảo an toàn, mật khẩu mới nên có ít nhất 8 ký tự bao gồm chữ cái, chữ số và ký hiệu đặc biệt.
        </p>

        <form id="changePasswordForm">
            <input type="hidden" name="Id" value="@Model" />

            <div class="mb-3">
                <label for="newPassword" class="form-label fw-semibold text-secondary small">
                    <i class="bi bi-key-fill me-1"></i>Mật khẩu mới
                </label>
                <div class="input-group">
                    <input type="password" class="form-control bg-light border-0 py-2 ps-3"
                           id="newPassword" name="NewPassword"
                           placeholder="Nhập mật khẩu mới..." required>
                    <button class="btn btn-light border-0 bg-light text-secondary" type="button" onclick="togglePassword('newPassword', this)">
                        <i class="bi bi-eye-slash-fill"></i>
                    </button>
                </div>
            </div>

            <div class="mb-2">
                <label for="confirmPassword" class="form-label fw-semibold text-secondary small">
                    <i class="bi bi-check-all me-1"></i>Xác nhận mật khẩu mới
                </label>
                <div class="input-group">
                    <input type="password" class="form-control bg-light border-0 py-2 ps-3"
                           id="confirmPassword" name="ConfirmPassword"
                           placeholder="Nhập lại mật khẩu mới..." required>
                    <button class="btn btn-light border-0 bg-light text-secondary" type="button" onclick="togglePassword('confirmPassword', this)">
                        <i class="bi bi-eye-slash-fill"></i>
                    </button>
                </div>
                <div id="password-match-error" class="text-danger small mt-2 d-none">
                    <i class="bi bi-exclamation-circle me-1"></i> Mật khẩu xác nhận không trùng khớp.
                </div>
            </div>
        </form>
    </div>

    <div class="modal-footer border-0 justify-content-center pt-3">
        <button type="button" class="btn btn-light px-4 rounded-pill border" onclick="closeEditModal()">
            Hủy bỏ
        </button>
        <button type="button" class="btn btn-warning px-4 rounded-pill shadow-sm text-dark fw-bold" id="btnSubmitChangePassword">
            <i class="bi bi-shield-check me-1"></i> Cập nhật mật khẩu
        </button>
    </div>
</div>

<style>
    .edit-modal-container {
        padding: 5px;
    }

    /* Custom Input Group cho Password */
    .input-group {
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.2s;
        border: 1px solid transparent;
    }

        .input-group:focus-within {
            border: 1px solid #ffc107 !important; /* Màu vàng theme warning */
            box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.15);
        }

    .form-control:focus {
        background-color: #fff !important;
        box-shadow: none !important;
        border: none !important;
    }

    /* Style chung */
    .btn-close-modal {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: #adb5bd;
        transition: 0.2s;
    }

        .btn-close-modal:hover {
            color: #495057;
            transform: rotate(90deg);
        }

    .rounded-pill {
        padding-top: 8px;
        padding-bottom: 8px;
        font-size: 0.9rem;
    }

    .bg-light {
        background-color: #f8f9fa !important;
    }
</style>

<script>
    /**
     * Hàm ẩn/hiện mật khẩu
     */
    function togglePassword(inputId, btn) {
        const input = document.getElementById(inputId);
        const icon = btn.querySelector('i');

        if (input.type === "password") {
            input.type = "text";
            icon.classList.replace('bi-eye-slash-fill', 'bi-eye-fill');
            icon.classList.add('text-primary');
        } else {
            input.type = "password";
            icon.classList.replace('bi-eye-fill', 'bi-eye-slash-fill');
            icon.classList.remove('text-primary');
        }
    }

    /**
     * Kiểm tra khớp mật khẩu thời gian thực
     */
    $('#confirmPassword').on('keyup', function () {
        const password = $('#newPassword').val();
        const confirm = $(this).val();
        const errorDiv = $('#password-match-error');

        if (confirm !== "" && password !== confirm) {
            errorDiv.classList.remove('d-none');
        } else {
            errorDiv.classList.add('d-none');
        }
    });

    /**
     * Xử lý nhấn nút cập nhật
     */
    $('#btnSubmitChangePassword').click(function() {
        const password = $('#newPassword').val();
        const confirm = $('#confirmPassword').val();

        if (password !== confirm) {
            toastr.error("Mật khẩu xác nhận không khớp!");
            return;
        }

        // Thực hiện AJAX gửi thông tin lên endpoint /web-api/account/change-password
        console.log("Đang tiến hành đổi mật khẩu...");
    });
</script>