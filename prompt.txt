Role: Expert .NET Fullstack Developer Task: Account Module Implementation with Dynamic UI, Image Processing, and Layout Integration

1. Context & Reference Materials

Framework: ASP.NET Core MVC (.NET 9).


UI Pattern: Follow the Abstract View Orchestration & AJAX Workflow defined in the file: UIShareLogic.txt, and the old logic with Document UI

System Settings: Use the AppSettings class (Infrastructure) to retrieve WebAppUrl and ImageBaseUrl from appsettings.json and appsettings.Development.json.

2. Layout & Global Configuration Integration

Refactor the Account Index View to inherit from _Layout.cshtml.

Ensure all assets (JS/CSS) and navigation links in the Layout use the WebAppUrl prefix injected via @inject IOptions<AppSettings>.

In the UI, whenever an AvatarUrl is received from the API (which is a relative path), prepend it with _appSettings.ImageBaseUrl to form the absolute path for rendering.

3. Account Module Logic (Controller & Business Layer)

DTO Sync: Clone the AccountDto and necessary Request objects from the AccountService (Web API) into the WebApp project.


List Loading: Implement the loadList() AJAX loop in Account/Index.cshtml to fetch the _AccountList partial view.


Update Request Logic: Implement the following logic in AccountBusiness.cs and AccountController.cs using a custom request class:

Class: UpdateWebAppAccountRequest

Properties: AccountId, Name, IsActive, IsChanged (bool), Avatar (string?), NewAvatar (IFormFile?).

Processing Workflow: 1. If IsChanged == false: Retain the existing Avatar path. 2. If IsChanged == true: * Upload NewAvatar to the Storage API (/web-api/storage/upload-minio-file) using the directory path: avatar/{AccountId}. * Capture the returned Value (new path) and update the Avatar property before calling the AccountService update endpoint.

4. UI Components & Requirements

Index View: Remove all fake data. Implement the table with columns: STT (calculated ), Name, Email, Avatar (Ảnh nền), Status (Trạng thái), and Actions.

Edit Partial View:

Include fields for Name and a Status dropdown (true = Active, false = Locked).

Implement the Avatar Upload section with a preview.

Use a hidden field for the IsChanged flag; set it to true via JavaScript only when a new file is selected.

Security & RBAC: Wrap admin-only features (Account Management, System Config, etc.) with @if (IdentityHelper.IsAdmin). Regular users should only see the "Chat" tab.

Icons: Use Bootstrap Icons exclusively (e.g., bi-pencil-square, bi-shield-lock, bi-trash3).

5. Assets & Feedback

Integrate SweetAlert2 for deletion confirmation and Toastr for action feedback.

Ensure a loading spinner is visible during all AJAX Partial View injections.

Source Files for Refactoring:

Account/Index.cshtml

Account/GetAccountDetail.cshtml

Account/ChangePasswordPartial.cshtml

AccountController.cs
Scripts/Account/account.js
AccountBusiness.cs

AppSettings.cs

UIShareLogic.txt (For architecture guidance)