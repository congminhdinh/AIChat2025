Task: Implement "Send Message" Flow (Hybrid Architecture) & Add Dependencies.

Context: We are implementing the messaging flow in the WebApp layer.

Sending (User): WebApp calls REST API (ChatBusiness -> Microservice).

Receiving (Bot): WebApp listens to SignalR events (ChatHub).

Files to Analyze & Modify:

WebApp/Services/Business/ChatBusiness.cs

WebApp/Controllers/ChatController.cs

wwwroot/Scripts/Chat/chat.js

WebApp/Views/Chat/Index.cshtml

Requirements:

1. Dependencies (CRITICAL):

Check Index.cshtml: If the Microsoft SignalR JavaScript client library is missing, you MUST add the script reference (use a reliable CDN like cdnjs) directly into the file (e.g., inside the Scripts section or before your chat.js import).

2. Backend (ChatBusiness & ChatController):

ChatBusiness: Implement the method to call POST /messages on the ChatService. Ensure DTOs match the Microservice's expectation.

ChatController: Create SendMessage action. It should receive the text, call Business layer, and return JSON "OK" immediately (async void) without waiting for the AI response.

3. Frontend (chat.js):

SignalR Setup:

Initialize signalR.HubConnectionBuilder.

Connect to the API Gateway URL (assume path /hubs/chat).

Event Listener: Listen for the Bot's response event (infer the event name from your previous analysis, e.g., BotResponse).

UI Update: When a signal is received, verify it belongs to the active conversation, then append the Bot's message bubble.

Sending Logic:

On Send: Render User's bubble immediately (Optimistic UI) -> Show Loading -> Call API via AJAX.

Constraint:

Do not modify the Microservice/ChatService code.

No comments in the code.