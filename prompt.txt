Plaintext

I need to update my Python `ChatProcessor` microservice to match the new message contracts and security logic from the .NET backend.

Here are the specific requirements:

### 1. Update Data Contracts (DTOs)
The input and output JSON structures have changed. Please update the Python data classes (or Pydantic models) to match these C# records exactly:

**Input (UserPromptReceivedEvent):**
```json
{
  "ConversationId": 123,
  "Message": "User query",
  "Token": "eyJhbG...",
  "Timestamp": "2024-01-01T12:00:00Z",
  "SystemInstruction": [] 
}
Note: SystemInstruction is a list of config objects.

Output (BotResponseCreatedEvent):

JSON

{
  "ConversationId": 123,
  "Message": "Bot response",
  "Token": "eyJhbG...", 
  "Timestamp": "2024-01-01T12:00:05Z",
  "ModelUsed": "qwen2.5:1.5b"
}
Crucial: The output MUST include the exact Token received from the input.

2. Implement JWT Validation
Before processing any message, the service must validate the Token.

Library: Use PyJWT (pip install pyjwt).

Config: Load JWT_SECRET_KEY from config.py (or environment variables).

Logic: Replicate this specific C# validation logic:

Algorithm: HS256 (HMAC SHA 256).

Verify Signature: YES.

Verify Issuer (iss): NO (Set verify_iss=False).

Verify Audience (aud): NO (Set verify_aud=False).

Verify Expiration (exp): YES (Default behavior).

Action: If the token is invalid or expired, log an error and do not process the message.

3. Execution Flow
Refactor the process_message method to follow this flow:

Parse the incoming JSON into UserPromptReceivedEvent.

Call a helper method validate_token(token).

If invalid -> Log error & Return/Stop.

If valid -> Proceed.

Execute the RAG logic (Embed -> Qdrant Search -> Ollama Generate).

Construct BotResponseCreatedEvent using the result and the original token.

Task
Keep all other logic the same, Please provide the updated Python code for ChatProcessor, and especially:

config.py (adding the secret key).

requirements.txt (adding PyJWT).